# DNS 查询优化

### 1、 缓存

> 缓存是双刃剑，提高了 DNS 查询的速度，也会影响 DNS 在 IP 变更时不能及时更新到最新。

DNS 查找的各个环节会对查找结果做缓存，从而提高下次查询的速度。

### 2、TTL(Time-To-Live)

存活时间，意思为一条域名解析记录在 DNS 服务器中的存留时间。通常，如果存留时间长，用户就可以尽可能多的从缓存中获取 DNS 解析记录，从而加快 DNS 解析速度。但是，如果缓存时间过长，当服务器出现问题后，就没法及时切换。所以 TTL 要根据具体情况来设置。

- 如果你只有一台服务器，TTL 就可以尽可能的设置长，最大限度的利用缓存加速。TTL 短的目的是服务器出了问题，能够尽量早的切换到其他服务器，但只有一个服务器的情况下，这点也利用不到。也不能无限长，一般 TTL 3600 即可

- > 如有备份或者多台服务器，会发生由于服务器宕机需要及时做切换，TTL 时间越短，切换越及时，但是 TTL 时间越短，也就意味着运营商 DNS 经常缓存不住，一般用户，设置为 TTL 600 即可，如果对及时切换，要求特别苛刻的网站，设置 TTL 120 即可。

### 3、足够热的域名解析商

> 什么叫热，就是被访问的次数特别多。足够热的话，域名解析服务器的 A 记录基本上会被各地运营商的 DNS 一直缓存着。

> 如何判断域名解析商够不够热呢？其实，也很简单，看看这个域名解析商的客户够不够多，他们客户网站够不够热门，访问的人够不够多。
>
> 也给大家推荐一个更好的方法，就是找 CDN 厂商做域名解析。因为 CDN 厂商服务的客户，有很多是很热很大用户群很多的，所以，这些 CDN 厂商的域名解析服务器，服务效果那是岗岗的好。

足够热，即 TTL 过期后，很快就有其他人访问从而刷新 TTL，这样大部分用户都可以从缓存中获取结果。

### 四、CNAME（别名记录）

具体见：[CNAME](./CNAME.md)

### 五、利用 `dns-prefetch` 预解析 DNS

当浏览器从（第三方）服务器请求资源时，必须先将该跨域域名解析为 IP 地址，然后浏览器才能发出请求。此过程称为 DNS 解析。DNS 缓存可以帮助减少此延迟，而 DNS 解析可以导致请求增加明显的延迟。对于打开了与许多第三方的连接的网站，此延迟可能会大大降低加载性能。

提示浏览器用户可能需要从指定域名加载资源，浏览器就可以预先进行 DNS 解析。

```html
<link rel="dns-prefetch" href="http://www.abc.com" />
```

参考：

1. [网站速度优化之 DNS 与拆分域名](http://www.baiwanzhan.com/site/t121469/)

2. [当你输入一个网址的时候，实际会发生什么?](https://www.cnblogs.com/wenanry/archive/2010/02/25/1673368.html)

3. [一文搞懂 DNS 缓存](https://blog.csdn.net/yonggeit/article/details/88175022)

4. [DNS 循环复用](https://baike.baidu.com/item/DNS%E5%BE%AA%E7%8E%AF%E5%A4%8D%E7%94%A8)

5. [关于 CNAME](https://www.jianshu.com/p/65757b5c0762)

6. [cname 记录是什么？他存在的意义是什么？](https://www.zhihu.com/question/22916306)

7. [负载均衡](https://baike.baidu.com/item/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1)
